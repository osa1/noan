{% extends "base.html" %}
{% load package_extras %}
{% load i18n %}
{% block title %}Arch Linux - Package Database{% endblock %}
{% block navbarclass %}anb-packages{% endblock %}

{% block head %}
<link rel="stylesheet" type="text/css" href="/media/admin_media/css/widgets.css" />
{% endblock %}

{% block content %}
<div id="pkglist-search" class="box filter-criteria">

    <h2>{% trans "Package Database" %}</h2>

    <h3>Package Search</h3>
    <form id="pkg-search" method="get" action="/packages/">
        <p><input type="hidden" name="sort" value='{{sort}}' /></p>
        {{ search_form.non_field_errors }}
        <fieldset>
            <legend>Enter search criteria</legend>
            <div>{{ search_form.architecture.errors }}
                <label for="id_architecture" title="Limit results a specific CPU architectureitecture">
                    Arch</label>{{ search_form.arch }}</div>
            <div>{{ search_form.repo.errors }}
                <label for="id_repo" title="Limit results to a specific respository">
                    Repository</label>{{ search_form.repo }}</div>
            <div>{{ search_form.repo.errors }}
                <label for="id_repo" title="Limit results to a specific respository">
                    Component</label>{{ search_form.pkgbase }}</div>
            <div>{{ search_form.q.errors }}
                <label for="id_q" title="Enter keywords as desired">
                    Keywords</label>{{ search_form.q }}</div>
            <div>{{ search_form.search_files.errors }}
                <label for="id_search_files" title="Search in package files">
                    Search in files</label>{{ search_form.search_files }}</div>
            <div>{{ search_form.packager.errors }}
                <label for="id_packager" title="Limit results to a specific packager">
                    Maintainer</label>{{ search_form.maintainer }}</div>
            <div>{{ search_form.last_update.errors }}
                <label for="id_last_update" title="Limit results to a date after the date entered">
                    Last Updated After</label>{{ search_form.last_update }}</div>
            <div>{{ search_form.limit.errors }}
                <label for="id_limit" title="Select the number of results to display per page">
                    Per Page</label>{{ search_form.limit }}</div>
            <div ><label>&nbsp;</label><input title="search for packages using this criteria"
                type="submit" value="search" /></div>
        </fieldset>
    </form>

</div><!-- #pkglist-search -->

{% if package_list %}
<div id="pkglist-results" class="box">

    {% if paginator %}
    <div id="pkglist-stats-top">

        <p>{{ paginator.count }} packages found. Page {{ page_obj.number }} of {{ paginator.num_pages }}.</p>

        <p class="pkglist-nav">
            {% if page_obj.has_previous %}
            <a class="prev" href="/packages/{{page_obj.previous_page_number}}/?{{current_query}}"
                title="Go to previous page">&lt; Prev</a>
            {% else %}
            <span class="prev">&lt; Prev</span>
            {% endif %}
            {% if page_obj.has_next %}
            <a class="next" href="/packages/{{page_obj.next_page_number}}/?{{current_query}}"
                title="Go to next page">Next &gt;</a>
            {% else %}
            <span class="next">Next &gt;</span>
            {% endif %}
        </p>

    </div>
    {% endif %}

    <form id="pkglist-results-form" method="post" action="/packages/update/">{% csrf_token %}

        <table class="results">
            <thead>
                <tr>
                    {% if perms.main.change_package %}
                    <th>&nbsp;</th>
                    {% endif %}
                    <th><a href="/packages/?{% buildsortqs "architecture" %}"
                            title="Sort packages by architectureitecture">Arch</a></th>
                    <th><a href="/packages/?{% buildsortqs "distribution" %}"
                            title="Sort packages by repository">Repo</a></th>
                    <th><a href="/packages/?{% buildsortqs "pkgbase" %}"
                            title="Sort packages by components">Component</a></th>
                    <th><a href="/packages/?{% buildsortqs "name" %}"
                            title="Sort packages by package name">Name</a></th>
                    <th>Version</th>
                    {% if files %}
                    <th>Files</th>
                    {% else %}
                    <th>Description</th>
                    {% endif %}
                    <th><a href="/packages/?{% buildsortqs "-last_update" %}"
                            title="Sort packages by last update">Last Updated</a></th>
                </tr>
            </thead>
            <tbody>
            {% for pkg in package_list %}
                <tr class="{% cycle 'odd' 'even' %}">
                    {% if perms.main.change_package %}
                    <td style="width: 1px;"><input type="checkbox" name="pkgid" value="{{ pkg.id }}" /></td>
                    {% endif %}
                    <td style="width: 1px;">{{ pkg.architecture.name }}</td>
                    <td style="width: 1px;">{{ pkg.repo.name|capfirst }}</td>
                    <td style="width: 1px;"><a href="/packages/?pkgbase={{pkg.partOf.name}}"
                            title="Component details for {{ pkg.partOf.name }}">{{ pkg.partOf.name }}</a></td>
                    <td style="width: 1px;"><a href="/packages/{{ pkg.url }}"
                            title="Package details for {{ pkg.name }}">{{ pkg.name }}</a></td>
                    <td style="width: 1px;">{{ pkg.full_version }}</td>
                    <td class="wrap">
                        {% if files %}
                            file1, file2, file3, ...
                        {% else %}
                            {{ pkg.pkgdesc }}
                        {% endif %}
                    </td>
                    <td style="width: 1px;">{{ pkg.last_update|date }}</td>
                    <!--<td>{{ pkg.flag_date|date }}</td>-->
                </tr>
            {% endfor %}
            </tbody>
        </table>

        {% if paginator %}
        <div id="pkglist-stats-bottom">

            <p>{{paginator.count}} packages found. Page {{page_obj.number}} of {{paginator.num_pages}}.</p>

                <p class="pkglist-nav">
                    {% if page_obj.has_previous %}
                    <a class="prev" href="/packages/{{page_obj.previous_page_number}}/?{{current_query}}"
                        title="Go to previous page">&lt; Prev</a>
                    {% else %}
                    <span class="prev">&lt; Prev</span>
                    {% endif %}
                    {% if page_obj.has_next %}
                    <a class="next" href="/packages/{{page_obj.next_page_number}}/?{{current_query}}"
                        title="Go to next page">Next &gt;</a>
                    {% else %}
                    <span class="next">Next &gt;</span>
                    {% endif %}
                </p>

        </div>
        {% endif %}

    </form>

</div><!-- #pkglist-results -->
{% else %}
<!-- TODO -->
<div class="box">
    <p>We couldn't find any packages matching your query. Try searching again
    using different criteria, or try
    {% if search_form.q.data %}
    <a href="https://aur.architecturelinux.org/packages.php?K={{ search_form.q.data }}">searching the AUR</a>
    {% else %}searching the AUR{% endif %}
    to see if the package can be found there.</p>
</div>
{% endif %}

<script type="text/javascript" src="/jsi18n/"></script>
{% load adminmedia %}<script type="text/javascript" src="{% admin_media_prefix %}js/core.js"></script>
<script type="text/javascript">window.__admin_media_prefix__ = "{% filter escapejs %}{% admin_media_prefix %}{% endfilter %}";</script>
{{search_form.media}}
{% endblock %}
